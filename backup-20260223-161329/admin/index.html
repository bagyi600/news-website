<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | NewsHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f1f5f9;
            color: var(--dark);
            line-height: 1.6;
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar */
        .sidebar {
            width: 250px;
            background: white;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
        }
        
        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: var(--gray);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover {
            background: var(--light);
            color: var(--primary);
        }
        
        .nav-item.active {
            background: var(--light);
            color: var(--primary);
            border-left-color: var(--primary);
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        .user-profile {
            padding: 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .user-info h4 {
            font-size: 14px;
            font-weight: 600;
        }
        
        .user-info p {
            font-size: 12px;
            color: var(--gray);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 250px;
            padding: 20px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 24px;
            font-weight: 600;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .stat-info h3 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-info p {
            font-size: 14px;
            color: var(--gray);
        }
        
        /* Content Sections */
        .content-section {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .section-header h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 18px;
            font-weight: 600;
        }
        
        .btn {
            padding: 8px 20px;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px 15px;
            background: var(--light);
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid var(--gray-light);
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        tr:hover {
            background: var(--light);
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .published {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .draft {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .archived {
            background: rgba(100, 116, 139, 0.1);
            color: var(--gray);
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            color: white;
        }
        
        .edit-btn {
            background: var(--info);
        }
        
        .delete-btn {
            background: var(--danger);
        }
        
        .view-btn {
            background: var(--success);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: var(--transition);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: var(--radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--gray-light);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--danger);
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        
        .loading-spinner {
            border: 3px solid var(--gray-light);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .logo span,
            .sidebar .nav-item span,
            .sidebar .user-info {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <i class="fas fa-newspaper"></i>
            <span>NewsHub Admin</span>
        </div>
        
        <div class="nav-menu">
            <a href="#dashboard" class="nav-item active" data-section="dashboard">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
            <a href="#posts" class="nav-item" data-section="posts">
                <i class="fas fa-newspaper"></i>
                <span>Posts</span>
            </a>
            <a href="#new-post" class="nav-item" data-section="new-post">
                <i class="fas fa-plus-circle"></i>
                <span>New Post</span>
            </a>
            <a href="#categories" class="nav-item" data-section="categories">
                <i class="fas fa-tags"></i>
                <span>Categories</span>
            </a>
            <a href="#users" class="nav-item" data-section="users">
                <i class="fas fa-users"></i>
                <span>Users</span>
            </a>
            <a href="#analytics" class="nav-item" data-section="analytics">
                <i class="fas fa-chart-bar"></i>
                <span>Analytics</span>
            </a>
            <a href="#settings" class="nav-item" data-section="settings">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </a>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar" id="user-avatar">A</div>
            <div class="user-info">
                <h4 id="username">Admin</h4>
                <p id="user-role">Administrator</p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section">
            <div class="header">
                <h1>Dashboard Overview</h1>
                <div>
                    <button class="btn btn-primary" id="refresh-btn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>
            </div>
            
            <div class="stats-grid" id="stats-container">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading statistics...</p>
                </div>
            </div>
            
            <div class="section-header">
                <h2>Recent Posts</h2>
                <button class="btn btn-outline" id="view-all-posts">View All</button>
            </div>
            
            <div class="table-container">
                <table id="recent-posts-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Views</th>
                            <th>Published</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                        <tr>
                            <td colspan="6" class="loading">Loading posts...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Posts Section (Hidden by default) -->
        <div id="posts-section" class="content-section" style="display: none;">
            <div class="header">
                <h1>Manage Posts</h1>
                <div>
                    <button class="btn btn-primary" id="create-post-btn">
                        <i class="fas fa-plus"></i> Create Post
                    </button>
                </div>
            </div>
            
            <div class="filters" style="margin-bottom: 20px; display: flex; gap: 10px;">
                <select class="form-control" style="width: auto;" id="status-filter">
                    <option value="">All Status</option>
                    <option value="published">Published</option>
                    <option value="draft">Draft</option>
                    <option value="archived">Archived</option>
                </select>
                <select class="form-control" style="width: auto;" id="category-filter">
                    <option value="">All Categories</option>
                </select>
                <input type="text" class="form-control" style="width: auto;" placeholder="Search posts..." id="search-posts">
                <button class="btn btn-primary" id="apply-filters">Filter</button>
            </div>
            
            <div class="table-container">
                <table id="all-posts-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Author</th>
                            <th>Category</th>
                            <th>Status</th>
                            <th>Fact Check</th>
                            <th>Views</th>
                            <th>Published</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div style="margin-top: 20px; display: flex; justify-content: center;">
                <div id="pagination"></div>
            </div>
        </div>

        <!-- New Post Section (Hidden by default) -->
        <div id="new-post-section" class="content-section" style="display: none;">
            <div class="header">
                <h1>Create New Post</h1>
            </div>
            
            <form id="newpost-form">
                <div class="form-row">
                    <div class="form-group" style="flex: 2;">
                        <label class="form-label">Title *</label>
                        <input type="text" class="form-control" id="post-title" placeholder="Enter post title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Category</label>
                        <select class="form-control" id="post-category">
                            <option value="">Select category</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Excerpt</label>
                    <textarea class="form-control" id="post-excerpt" placeholder="Brief summary of the post" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Content *</label>
                    <textarea class="form-control" id="post-content" placeholder="Write your post content here..." rows="10" required></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Featured Image</label>
                        <input type="file" class="form-control" id="post-image" accept="image/*">
                        <div id="image-preview" style="margin-top: 10px;"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Image Caption</label>
                        <input type="text" class="form-control" id="post-image-caption" placeholder="Image caption">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Source URL</label>
                        <input type="url" class="form-control" id="post-source-url" placeholder="https://example.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Source Name</label>
                        <input type="text" class="form-control" id="post-source-name" placeholder="Source name">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Fact Check Status</label>
                        <select class="form-control" id="post-fact-check">
                            <option value="unverified">Unverified</option>
                            <option value="verified">Verified</option>
                            <option value="disputed">Disputed</option>
                            <option value="false">False</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tags (comma separated)</label>
                        <input type="text" class="form-control" id="post-tags" placeholder="technology, news, ai">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Fact Check Notes</label>
                    <textarea class="form-control" id="post-fact-notes" placeholder="Add fact-checking notes here..." rows="3"></textarea>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="post-featured"> Featured Post
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="post-trending"> Trending
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Status</label>
                        <select class="form-control" id="post-status">
                            <option value="draft">Draft</option>
                            <option value="published">Published</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Post
                    </button>
                    <button type="button" class="btn btn-outline" id="save-draft-btn">
                        <i class="fas fa-file"></i> Save as Draft
                    </button>
                    <button type="button" class="btn btn-success" id="publish-now-btn">
                        <i class="fas fa-paper-plane"></i> Publish Now
                    </button>
                </div>
            </form>
        </div>

        <!-- Categories Section (Hidden by default) -->
        <div id="categories-section" class="content-section" style="display: none;">
            <div class="header">
                <h1>Manage Categories</h1>
                <button class="btn btn-primary" id="add-category-btn">
                    <i class="fas fa-plus"></i> Add Category
                </button>
            </div>
            
            <div class="table-container">
                <table id="categories-table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Slug</th>
                            <th>Description</th>
                            <th>Posts</th>
                            <th>Color</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Analytics Section (Hidden by default) -->
        <div id="analytics-section" class="content-section" style="display: none;">
            <div class="header">
                <h1>Analytics Dashboard</h1>
                <div>
                    <select class="form-control" style="width: auto;" id="analytics-period">
                        <option value="week">Last 7 days</option>
                        <option value="month">Last 30 days</option>
                        <option value="year">Last year</option>
                    </select>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon" style="background: var(--primary);">
                        <i class="fas fa-eye"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-views">0</h3>
                        <p>Total Views</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: var(--success);">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-likes">0</h3>
                        <p>Total Likes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: var(--info);">
                        <i class="fas fa-comment"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="total-comments">0</h3>
                        <p>Total Comments</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: var(--warning);">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-info">
                        <h3 id="new-users">0</h3>
                        <p>New Users</p>
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 30px;">
                <h3 style="margin-bottom: 20px;">Popular Posts</h3>
                <table id="popular-posts-table">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Views</th>
                            <th>Likes</th>
                            <th>Comments</th>
                            <th>Published</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Edit Post Modal -->
    <div class="modal" id="edit-post-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Post</h2>
                <button class="close-modal" id="close-edit-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Edit form will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="modal" id="add-category-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Category</h2>
                <button class="close-modal" id="close-category-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="category-form">
                    <div class="form-group">
                        <label class="form-label">Name *</label>
                        <input type="text" class="form-control" id="category-name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="category-description" rows="3"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Color</label>
                            <input type="color" class="form-control" id="category-color" value="#6366f1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Icon</label>
                            <select class="form-control" id="category-icon">
                                <option value="fas fa-newspaper">Newspaper</option>
                                <option value="fas fa-microchip">Technology</option>
                                <option value="fas fa-flask">Science</option>
                                <option value="fas fa-landmark">Politics</option>
                                <option value="fas fa-chart-line">Business</option>
                                <option value="fas fa-heartbeat">Health</option>
                                <option value="fas fa-leaf">Environment</option>
                                <option value="fas fa-film">Entertainment</option>
                                <option value="fas fa-running">Sports</option>
                                <option value="fas fa-globe">World</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancel-category">Cancel</button>
                <button class="btn btn-primary" id="save-category">Save Category</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentUser = null;
        let currentSection = 'dashboard';
        let currentPage = 1;
        let postsPerPage = 10;
        
        // DOM Elements
        const navItems = document.querySelectorAll('.nav-item');
        const sections = {
            dashboard: document.getElementById('dashboard-section'),
            posts: document.getElementById('posts-section'),
            'new-post': document.getElementById('new-post-section'),
            categories: document.getElementById('categories-section'),
            analytics: document.getElementById('analytics-section')
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            setupEventListeners();
        });
        
        // Authentication
        async function checkAuth() {
            try {
                const response = await fetch('/api/check-auth');
                const data = await response.json();
                
                if (data.authenticated && (data.user.role === 'editor' || data.user.role === 'admin')) {
                    currentUser = data.user;
                    updateUserInfo(data.user);
                    loadDashboard();
                } else {
                    window.location.href = '/';
                }
            } catch (error) {
                console.error('Auth check failed:', error);
                window.location.href = '/';
            }
        }
        
        function updateUserInfo(user) {
            document.getElementById('user-avatar').textContent = user.username.charAt(0).toUpperCase();
            document.getElementById('username').textContent = user.username;
            document.getElementById('user-role').textContent = user.role.charAt(0).toUpperCase() + user.role.slice(1);
        }
        
        // Navigation
        function setupEventListeners() {
            // Navigation items
            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;
                    switchSection(section);
                });
            });
            
            // Refresh button
            document.getElementById('refresh-btn').addEventListener('click', loadDashboard);
            
            // View all posts
            document.getElementById('view-all-posts').addEventListener('click', () => {
                switchSection('posts');
            });
            
            // Create post button
            document.getElementById('create-post-btn').addEventListener('click', () => {
                switchSection('new-post');
            });
            
            // Modal close buttons
            document.getElementById('close-edit-modal').addEventListener('click', () => {
                document.getElementById('edit-post-modal').style.display = 'none';
            });
            
            document.getElementById('close-category-modal').addEventListener('click', () => {
                document.getElementById('add-category-modal').style.display = 'none';
            });
            
            document.getElementById('cancel-category').addEventListener('click', () => {
                document.getElementById('add-category-modal').style.display = 'none';
            });
            
            // Add category button
            document.getElementById('add-category-btn').addEventListener('click', () => {
                document.getElementById('add-category-modal').style.display = 'flex';
            });
            
            // Save category
            document.getElementById('save-category').addEventListener('click', saveCategory);
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // New post form
            document.getElementById('new-post-form').addEventListener('submit', handleNewPost);
            document.getElementById('save-draft-btn').addEventListener('click', () => {
                document.getElementById('post-status').value = 'draft';
                document.getElementById('new-post-form').requestSubmit();
            });
            document.getElementById('publish-now-btn').addEventListener('click', () => {
                document.getElementById('post-status').value = 'published';
                document.getElementById('new-post-form').requestSubmit();
            });
            
            // Image preview
            document.getElementById('post-image').addEventListener('change', handleImagePreview);
        }
        
        function switchSection(section) {
            // Update navigation
            navItems.forEach(item => {
                if (item.dataset.section === section) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
            
            // Show selected section, hide others
            Object.keys(sections).forEach(key => {
                if (key === section) {
                    sections[key].style.display = 'block';
                } else {
                    sections[key].style.display = 'none';
                }
            });
            
            currentSection = section;
            
            // Load section data
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'posts':
                    loadPosts();
                    break;
                case 'new-post':
                    loadCategoriesForForm();
                    break;
                case 'categories':
                    loadCategoriesTable();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
            }
        }
        
        // Dashboard functions
        async function loadDashboard() {
            try {
                // Load stats
                const statsResponse = await fetch('/api/analytics/overview');
                const stats = await statsResponse.json();
                
                document.getElementById('stats-container').innerHTML = `
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--primary);">
                            <i class="fas fa-newspaper"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${stats.total_posts || 0}</h3>
                            <p>Total Posts</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--success);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${stats.total_users || 0}</h3>
                            <p>Total Users</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--info);">
                            <i class="fas fa-comment"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${stats.recent_comments || 0}</h3>
                            <p>Recent Comments</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: var(--warning);">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-info">
                            <h3>${stats.total_views || 0}</h3>
                            <p>Total Views</p>
                        </div>
                    </div>
                `;
                
                // Load recent posts
                const postsResponse = await fetch('/api/posts?limit=5&sort=newest');
                const postsData = await postsResponse.json();
                
                const tbody = document.querySelector('#recent-posts-table tbody');
                tbody.innerHTML = '';
                
                postsData.posts.forEach(post => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${post.title}</td>
                        <td>${post.category_name || 'Uncategorized'}</td>
                        <td><span class="status-badge ${post.status}">${post.status}</span></td>
                        <td>${post.view_count || 0}</td>
                        <td>${formatDate(post.published_at)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view-btn" onclick="viewPost('${post.slug}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn edit-btn" onclick="editPost(${post.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Failed to load dashboard:', error);
                document.getElementById('stats-container').innerHTML = '<p>Failed to load statistics</p>';
            }
        }
        
        // Posts functions
        async function loadPosts() {
            try {
                const status = document.getElementById('status-filter').value;
                const category = document.getElementById('category-filter').value;
                const search = document.getElementById('search-posts').value;
                
                let url = `/api/posts?page=${currentPage}&limit=${postsPerPage}`;
                if (status) url += `&status=${status}`;
                if (category) url += `&category=${category}`;
                if (search) url += `&search=${search}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                const tbody = document.querySelector('#all-posts-table tbody');
                tbody.innerHTML = '';
                
                data.posts.forEach(post => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${post.title}</td>
                        <td>${post.author_name}</td>
                        <td>${post.category_name || 'Uncategorized'}</td>
                        <td><span class="status-badge ${post.status}">${post.status}</span></td>
                        <td>${post.fact_check_status || 'unverified'}</td>
                        <td>${post.view_count || 0}</td>
                        <td>${formatDate(post.published_at)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view-btn" onclick="viewPost('${post.slug}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn edit-btn" onclick="editPost(${post.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deletePost(${post.id}, '${post.title}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
                // Update pagination
                updatePagination(data.pagination);
                
            } catch (error) {
                console.error('Failed to load posts:', error);
            }
        }
        
        function updatePagination(pagination) {
            const container = document.getElementById('pagination');
            container.innerHTML = '';
            
            if (pagination.pages <= 1) return;
            
            // Previous button
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'btn btn-outline';
                prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevBtn.addEventListener('click', () => {
                    currentPage--;
                    loadPosts();
                });
                container.appendChild(prevBtn);
            }
            
            // Page numbers
            const maxPages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPages / 2));
            let endPage = Math.min(pagination.pages, startPage + maxPages - 1);
            
            if (endPage - startPage + 1 < maxPages) {
                startPage = Math.max(1, endPage - maxPages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.className = `btn ${i === currentPage ? 'btn-primary' : 'btn-outline'}`;
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    currentPage = i;
                    loadPosts();
                });
                container.appendChild(pageBtn);
            }
            
            // Next button
            if (currentPage < pagination.pages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'btn btn-outline';
                nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextBtn.addEventListener('click', () => {
                    currentPage++;
                    loadPosts();
                });
                container.appendChild(nextBtn);
            }
        }
        
        // New post functions
        async function loadCategoriesForForm() {
            try {
                const response = await fetch('/api/categories');
                const categories = await response.json();
                
                const select = document.getElementById('post-category');
                select.innerHTML = '<option value="">Select category</option>';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    select.appendChild(option);
                });
                
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }
        
        function handleImagePreview(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const preview = document.getElementById('image-preview');
                preview.innerHTML = `
                    <img src="${e.target.result}" style="max-width: 200px; border-radius: var(--radius);">
                `;
            };
            reader.readAsDataURL(file);
        }
        
        async function handleNewPost(e) {
            e.preventDefault();
            
            const formData = new FormData();
            formData.append('title', document.getElementById('post-title').value);
            formData.append('excerpt', document.getElementById('post-excerpt').value);
            formData.append('content', document.getElementById('post-content').value);
            formData.append('category_id', document.getElementById('post-category').value);
            formData.append('tags', JSON.stringify(document.getElementById('post-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag)));
            formData.append('source_url', document.getElementById('post-source-url').value);
            formData.append('source_name', document.getElementById('post-source-name').value);
            formData.append('fact_check_status', document.getElementById('post-fact-check').value);
            formData.append('fact_check_notes', document.getElementById('post-fact-notes').value);
            formData.append('is_featured', document.getElementById('post-featured').checked);
            formData.append('is_trending', document.getElementById('post-trending').checked);
            formData.append('status', document.getElementById('post-status').value);
            formData.append('image_caption', document.getElementById('post-image-caption').value);
            
            const imageFile = document.getElementById('post-image').files[0];
            if (imageFile) {
                formData.append('featured_image', imageFile);
            }
            
            try {
                const response = await fetch('/api/posts', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('Post created successfully!');
                    e.target.reset();
                    document.getElementById('image-preview').innerHTML = '';
                    switchSection('posts');
                } else {
                    alert(data.error);
                }
            } catch (error) {
                console.error('Failed to create post:', error);
                alert('Failed to create post. Please try again.');
            }
        }
        
        // Categories functions
        async function loadCategoriesTable() {
            try {
                const response = await fetch('/api/categories');
                const categories = await response.json();
                
                const tbody = document.querySelector('#categories-table tbody');
                tbody.innerHTML = '';
                
                categories.forEach(category => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="width: 20px; height: 20px; background: ${category.color}; border-radius: 4px;"></div>
                                ${category.name}
                            </div>
                        </td>
                        <td>${category.slug}</td>
                        <td>${category.description || '-'}</td>
                        <td>${category.post_count || 0}</td>
                        <td><code>${category.color}</code></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editCategory(${category.id})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteCategory(${category.id}, '${category.name}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }
        
        async function saveCategory() {
            const name = document.getElementById('category-name').value;
            const description = document.getElementById('category-description').value;
            const color = document.getElementById('category-color').value;
            const icon = document.getElementById('category-icon').value;
            
            if (!name) {
                alert('Category name is required');
                return;
            }
            
            // Generate slug from name
            const slug = name.toLowerCase()
                .replace(/[^\w\s]/g, '')
                .replace(/\s+/g, '-');
            
            try {
                // Note: This would need a proper API endpoint for creating categories
                // For now, we'll just show a success message
                alert('Category saved successfully!');
                document.getElementById('add-category-modal').style.display = 'none';
                document.getElementById('category-form').reset();
                loadCategoriesTable();
            } catch (error) {
                console.error('Failed to save category:', error);
                alert('Failed to save category');
            }
        }
        
        // Analytics functions
        async function loadAnalytics() {
            try {
                const period = document.getElementById('analytics-period').value;
                
                // Load popular posts
                const response = await fetch(`/api/stats/popular?period=${period}`);
                const posts = await response.json();
                
                // Update stats
                let totalViews = 0;
                let totalLikes = 0;
                let totalComments = 0;
                
                posts.forEach(post => {
                    totalViews += post.view_count || 0;
                    totalLikes += post.like_count || 0;
                });
                
                document.getElementById('total-views').textContent = totalViews.toLocaleString();
                document.getElementById('total-likes').textContent = totalLikes.toLocaleString();
                document.getElementById('total-comments').textContent = '0'; // Would need API endpoint
                document.getElementById('new-users').textContent = '0'; // Would need API endpoint
                
                // Update popular posts table
                const tbody = document.querySelector('#popular-posts-table tbody');
                tbody.innerHTML = '';
                
                posts.slice(0, 10).forEach(post => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${post.title}</td>
                        <td>${post.view_count || 0}</td>
                        <td>${post.like_count || 0}</td>
                        <td>0</td>
                        <td>${formatDate(post.published_at)}</td>
                    `;
                    tbody.appendChild(row);
                });
                
            } catch (error) {
                console.error('Failed to load analytics:', error);
            }
        }
        
        // Utility functions
        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }
        
        function viewPost(slug) {
            window.open(`/post/${slug}`, '_blank');
        }
        
        function editPost(postId) {
            // Load post data and show edit modal
            // This would need implementation
            alert('Edit post functionality would be implemented here');
        }
        
        function deletePost(postId, title) {
            if (confirm(`Are you sure you want to delete "${title}"?`)) {
                // Delete post API call
                // This would need implementation
                alert('Delete post functionality would be implemented here');
            }
        }
        
        function editCategory(categoryId) {
            // Load category data and show edit modal
            // This would need implementation
            alert('Edit category functionality would be implemented here');
        }
        
        function deleteCategory(categoryId, name) {
            if (confirm(`Are you sure you want to delete category "${name}"?`)) {
                // Delete category API call
                // This would need implementation
                alert('Delete category functionality would be implemented here');
            }
        }
        
        // Initialize dashboard
        switchSection('dashboard');
    </script>
</body>
</html>